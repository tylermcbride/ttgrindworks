[gd_scene load_steps=24 format=3 uid="uid://c3jefjvjikh4q"]

[ext_resource type="PackedScene" uid="uid://c8flauti1cf1p" path="res://objects/modules/office/base_rooms/office_obstacle_room.tscn" id="1_c305m"]
[ext_resource type="Texture2D" uid="uid://dmelmjyqb5mqh" path="res://models/facilities/office/textures/LB_Carpet.png" id="5_nl5fk"]
[ext_resource type="PackedScene" uid="uid://dbrst2twjd0pu" path="res://objects/interactables/button/button.tscn" id="7_q5d2e"]
[ext_resource type="PackedScene" uid="uid://bqo1n7rw85igy" path="res://objects/interactables/elevators/elevator_law.tscn" id="8_onmkf"]
[ext_resource type="Script" path="res://objects/interactables/lawbot_puzzles/puzzle_run.gd" id="9_nymlb"]
[ext_resource type="PackedScene" uid="uid://dxyq5lb5oineo" path="res://objects/interactables/treasure_chest/treasure_chest.tscn" id="10_ce2fe"]
[ext_resource type="Script" path="res://objects/interactables/lawbot_puzzles/puzzle_skull_finder.gd" id="11_6xe4u"]
[ext_resource type="Script" path="res://objects/interactables/lawbot_puzzles/puzzle_avoid_skulls.gd" id="11_eqt47"]
[ext_resource type="PackedScene" uid="uid://btajacdw0exth" path="res://objects/props/office/partition.tscn" id="12_s38sp"]
[ext_resource type="PackedScene" uid="uid://cng3jffjmwdv8" path="res://objects/props/office/couch.tscn" id="15_qr1bn"]
[ext_resource type="PackedScene" uid="uid://d0bnakgqatchq" path="res://objects/props/office/lamp_big.tscn" id="16_0lofk"]
[ext_resource type="PackedScene" uid="uid://c6mq4831rc0uj" path="res://objects/props/office/portrait_backstabber.tscn" id="17_186wd"]
[ext_resource type="PackedScene" uid="uid://ceghombqxco7o" path="res://objects/props/office/bookshelf.tscn" id="18_vk3hr"]
[ext_resource type="PackedScene" uid="uid://dm86vgodo58fx" path="res://objects/props/office/potted_plant.tscn" id="19_clgcs"]
[ext_resource type="PackedScene" uid="uid://b5d0mrdvwx3cp" path="res://objects/items/boss_chest_group.tscn" id="19_yjtuy"]
[ext_resource type="PackedScene" uid="uid://bolaea3btm1ae" path="res://objects/props/office/da_crate.tscn" id="20_361ij"]
[ext_resource type="PackedScene" uid="uid://dimw8665cqqxw" path="res://objects/props/office/desk.tscn" id="21_a5uum"]
[ext_resource type="PackedScene" uid="uid://b1cl5gdttc2ps" path="res://objects/props/office/lamp_small.tscn" id="22_2uox3"]
[ext_resource type="PackedScene" uid="uid://dn6p7pcjhawfb" path="res://objects/props/office/chair.tscn" id="23_hfqgh"]

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_ukme4"]
resource_name = "lambert3"
vertex_color_use_as_albedo = true
albedo_color = Color(0.906332, 0.906332, 0.906332, 0.8)
albedo_texture = ExtResource("5_nl5fk")
emission_enabled = true

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_1ugpq"]
resource_name = "lambert3"
vertex_color_use_as_albedo = true
albedo_color = Color(0.906332, 0.906332, 0.906332, 0.8)
albedo_texture = ExtResource("5_nl5fk")
emission_enabled = true

[sub_resource type="GDScript" id="GDScript_873pa"]
resource_name = "puzzle_treasures"
script/source = "extends Node3D


func right_puzzle_lost() -> void:
	delete_chest($TreasureRight)
	$PuzzleRun.queue_free()

func left_puzzle_lost() -> void:
	delete_chest($TreasureLeft)
	$PuzzleAvoidSkulls.queue_free()


func delete_chest(chest: TreasureChest) -> void:
	var dust_cloud = Globals.DUST_CLOUD.load().instantiate()
	add_child(dust_cloud)
	dust_cloud.global_position = chest.global_position
	chest.queue_free()
"

[sub_resource type="GDScript" id="GDScript_7uaa0"]
resource_name = "bookshelf_blocker"
script/source = "extends Node3D

const SKULLFINDER_MUSIC := preload(\"res://audio/music/encntr_skull_master.ogg\")

@export var block_pos: Vector3

@onready var start_pos: Vector3 = position

var tween: Tween:
	set(x):
		if tween and tween.is_valid():
			tween.kill()
		tween = x

func _ready() -> void:
	position = block_pos

func move_to_block() -> void:
	Util.stuck_lock = true
	tween = Sequence.new([
		LerpProperty.new(self, ^\"position\", 0.5, start_pos).interp(Tween.EASE_IN_OUT, Tween.TRANS_QUAD),
	]).as_tween(self)
	AudioManager.set_music(SKULLFINDER_MUSIC)

func move_to_unblock() -> void:
	Util.stuck_lock = false
	tween = Sequence.new([
		LerpProperty.new(self, ^\"position\", 1.5, block_pos).interp(Tween.EASE_IN_OUT, Tween.TRANS_QUAD),
	]).as_tween(self)
	AudioManager.stop_music()
"

[node name="SkullFinderRoom" instance=ExtResource("1_c305m")]

[node name="floor" parent="Z08_ALL/Z08/boiler_room/room/geometry_boiler_room" index="3"]
surface_material_override/0 = SubResource("StandardMaterial3D_ukme4")

[node name="GeometryTransformHelper7" parent="Z08_ALL/Z08/boiler_room/room/geometry_boiler_room/floor2" index="0"]
surface_material_override/0 = SubResource("StandardMaterial3D_1ugpq")

[node name="Puzzle" type="Node3D" parent="." index="10"]

[node name="CogButton" parent="Puzzle" index="0" node_paths=PackedStringArray("connected_objects") instance=ExtResource("7_q5d2e")]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, -16.39, 0, 0.61)
up_color = Color(1, 1, 1, 1)
connected_objects = [NodePath("../PuzzleSkullFinder")]

[node name="PuzzleSkullFinder" type="Node3D" parent="Puzzle" index="1"]
transform = Transform3D(-8.30516e-08, 0, -1.9, 0, 1.9, 0, 1.9, 0, -8.30516e-08, 18.495, 0.05, -7.905)
script = ExtResource("11_6xe4u")
bomb_count = 32
lose_type = 1
explosion_damage = -4
grid_width = 9
grid_height = 17
beam_height = 5.0

[node name="Partitions" type="Node3D" parent="." index="11"]

[node name="LeftSide" type="Node3D" parent="Partitions" index="0"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 4.9525, 0, 9.27181)

[node name="partition" parent="Partitions/LeftSide" index="0" instance=ExtResource("12_s38sp")]

[node name="partition2" parent="Partitions/LeftSide" index="1" instance=ExtResource("12_s38sp")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 4.70441, 0, 0)

[node name="partition3" parent="Partitions/LeftSide" index="2" instance=ExtResource("12_s38sp")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 9.38695, 0, 0)

[node name="partition4" parent="Partitions/LeftSide" index="3" instance=ExtResource("12_s38sp")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 14.0918, 0, 0)

[node name="partition5" parent="Partitions/LeftSide" index="4" instance=ExtResource("12_s38sp")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -4.74761, 0, 0)

[node name="partition6" parent="Partitions/LeftSide" index="5" instance=ExtResource("12_s38sp")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -18.8665, 0, 0)

[node name="partition7" parent="Partitions/LeftSide" index="6" instance=ExtResource("12_s38sp")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -14.1621, 0, 0)

[node name="partition8" parent="Partitions/LeftSide" index="7" instance=ExtResource("12_s38sp")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -9.47957, 0, 0)

[node name="RightSide" type="Node3D" parent="Partitions" index="1"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 3.62276, 0, -7.89796)

[node name="partition" parent="Partitions/RightSide" index="0" instance=ExtResource("12_s38sp")]

[node name="partition2" parent="Partitions/RightSide" index="1" instance=ExtResource("12_s38sp")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 4.70441, 0, 0)

[node name="partition3" parent="Partitions/RightSide" index="2" instance=ExtResource("12_s38sp")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 9.38695, 0, 0)

[node name="partition4" parent="Partitions/RightSide" index="3" instance=ExtResource("12_s38sp")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 14.0918, 0, 0)

[node name="partition5" parent="Partitions/RightSide" index="4" instance=ExtResource("12_s38sp")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -4.74761, 0, 0)

[node name="partition7" parent="Partitions/RightSide" index="5" instance=ExtResource("12_s38sp")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -14.1621, 0, 0)

[node name="partition8" parent="Partitions/RightSide" index="6" instance=ExtResource("12_s38sp")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -9.47957, 0, 0)

[node name="Top" type="Node3D" parent="Partitions" index="2"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 3.364, 3.099, -13.836)

[node name="partition" parent="Partitions/Top" index="0" instance=ExtResource("12_s38sp")]

[node name="partition2" parent="Partitions/Top" index="1" instance=ExtResource("12_s38sp")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 4.70441, 0, 0)

[node name="partition3" parent="Partitions/Top" index="2" instance=ExtResource("12_s38sp")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 9.38695, 0, 0)

[node name="partition4" parent="Partitions/Top" index="3" instance=ExtResource("12_s38sp")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 14.0918, 0, 0)

[node name="partition5" parent="Partitions/Top" index="4" instance=ExtResource("12_s38sp")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -4.74761, 0, 0)

[node name="partition7" parent="Partitions/Top" index="5" instance=ExtResource("12_s38sp")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -14.1621, 0, 0)

[node name="partition8" parent="Partitions/Top" index="6" instance=ExtResource("12_s38sp")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -9.47957, 0, 0)

[node name="elevator_law" parent="." index="12" instance=ExtResource("8_onmkf")]
transform = Transform3D(0.4, 0, 0, 0, 0.4, 0, 0, 0, 0.4, -0.541, 3.33472, -27.271)

[node name="PuzzleTreasures" type="Node3D" parent="." index="13"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -11.3704)
script = SubResource("GDScript_873pa")

[node name="PuzzleRun" type="Node3D" parent="PuzzleTreasures" index="0"]
transform = Transform3D(-8.30516e-08, 0, 1.9, 0, 1.9, 0, -1.9, 0, -8.30516e-08, -13.581, 0.04, 3.306)
script = ExtResource("9_nymlb")
wait_time = 0.15
lose_type = 2
grid_width = 3
grid_height = 15

[node name="TreasureRight" parent="PuzzleTreasures" index="1" instance=ExtResource("10_ce2fe")]
transform = Transform3D(-4.37114e-08, 0, -1, 0, 1, 0, 1, 0, -4.37114e-08, 17.5167, 0, 0.33753)

[node name="PuzzleAvoidSkulls" type="Node3D" parent="PuzzleTreasures" index="2"]
transform = Transform3D(-8.30516e-08, 0, 1.9, 0, 1.9, 0, -1.9, 0, -8.30516e-08, -16.041, 0.04, 24.973)
script = ExtResource("11_eqt47")
lose_type = 2
grid_width = 2
grid_height = 15

[node name="TreasureLeft" parent="PuzzleTreasures" index="3" instance=ExtResource("10_ce2fe")]
transform = Transform3D(-4.37114e-08, 0, -1, 0, 1, 0, 1, 0, -4.37114e-08, 17.517, 0.143, 22.896)

[node name="Props" type="Node3D" parent="." index="14"]

[node name="couch" parent="Props" index="0" instance=ExtResource("15_qr1bn")]
transform = Transform3D(-5.46392e-08, 0, -1.25, 0, 1.25, 0, 1.25, 0, -5.46392e-08, 20.9219, 0, 11.3211)

[node name="lamp_big" parent="Props" index="1" instance=ExtResource("16_0lofk")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 21.1686, 0, 13.8035)

[node name="lamp_big2" parent="Props" index="2" instance=ExtResource("16_0lofk")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 18.8831, 0, -13.0867)

[node name="PortraitBackstabber" parent="Props" index="3" instance=ExtResource("17_186wd")]
transform = Transform3D(-6.55671e-08, 0, -1.5, 0, 1.5, 0, 1.5, 0, -6.55671e-08, -20.8204, 3.90507, 0)

[node name="law_bookshelf" parent="Props" index="4" instance=ExtResource("18_vk3hr")]
transform = Transform3D(-6.55671e-08, 0, 1.5, 0, 1.5, 0, -1.5, 0, -6.55671e-08, -20.6149, 0, 9.0797)

[node name="law_bookshelf2" parent="Props" index="5" instance=ExtResource("18_vk3hr")]
transform = Transform3D(-6.55671e-08, 0, 1.5, 0, 1.5, 0, -1.5, 0, -6.55671e-08, -20.6149, 0, 5.08451)

[node name="law_bookshelf3" parent="Props" index="6" instance=ExtResource("18_vk3hr")]
transform = Transform3D(-6.55671e-08, 0, 1.5, 0, 1.5, 0, -1.5, 0, -6.55671e-08, -20.6149, 0, 1.07054)

[node name="law_bookshelf4" parent="Props" index="7" instance=ExtResource("18_vk3hr")]
transform = Transform3D(-6.55671e-08, 0, 1.5, 0, 1.5, 0, -1.5, 0, -6.55671e-08, -20.6149, 0, -2.92656)

[node name="law_bookshelf5" parent="Props" index="8" instance=ExtResource("18_vk3hr")]
transform = Transform3D(1.13131, 0, 0.984958, 0, 1.5, 0, -0.984958, 0, 1.13131, -13.788, 3.25, -19.611)

[node name="law_bookshelf6" parent="Props" index="9" instance=ExtResource("18_vk3hr")]
transform = Transform3D(1.13202, -0.009879, 0.984089, 0.0130898, 1.49994, 0, -0.984051, 0.00858769, 1.13206, -10.773, 3.27, -22.236)

[node name="potted_plant" parent="Props" index="10" instance=ExtResource("19_clgcs")]
transform = Transform3D(5.54349, 0, -5.76799, 0, 8, 0, 5.76799, 0, 5.54349, 19.2098, 0, -6.97855)

[node name="potted_plant2" parent="Props" index="11" instance=ExtResource("19_clgcs")]
transform = Transform3D(5.54349, 0, -5.76799, 0, 8, 0, 5.76799, 0, 5.54349, 20.53, 0.01, 8.484)

[node name="da_crate" parent="Props" index="12" instance=ExtResource("20_361ij")]
transform = Transform3D(1.60336, -0.00788877, -0.564955, 0, 1.69983, -0.0237357, 0.56501, 0.0223864, 1.6032, 13.7248, 3.2, -16.0477)

[node name="da_crate2" parent="Props" index="13" instance=ExtResource("20_361ij")]
transform = Transform3D(1.60336, -0.00788877, -0.564955, 0, 1.69983, -0.0237357, 0.56501, 0.0223864, 1.6032, 13.7122, 5.91653, -16.0119)
visible = false

[node name="desk" parent="Props" index="14" instance=ExtResource("21_a5uum")]
transform = Transform3D(0.412154, 0, 1.1801, 0, 1.25, 0, -1.1801, 0, 0.412154, 11.644, 3.24302, -16.6727)

[node name="lamp_small" parent="Props/desk" index="2" instance=ExtResource("22_2uox3")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 1.01649, 0.973984, 0.222244)

[node name="chair" parent="Props/desk" index="3" instance=ExtResource("23_hfqgh")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.0873713, 0, -1.35911)

[node name="BossChestGroup" parent="." index="15" instance=ExtResource("19_yjtuy")]
transform = Transform3D(-4.37114e-08, 0, -1, 0, 1, 0, 1, 0, -4.37114e-08, 4.89105, 3.24361, -20.6067)

[node name="RoomBlocker" parent="." index="16" instance=ExtResource("18_vk3hr")]
unique_name_in_owner = true
transform = Transform3D(0.0975251, 0, -1.99762, 0, 2, 0, 1.99762, 0, 0.0975251, 23.2006, 0, -3.07852)
script = SubResource("GDScript_7uaa0")
block_pos = Vector3(23.201, 0, -12)

[connection signal="s_began_interaction" from="Puzzle/PuzzleSkullFinder" to="RoomBlocker" method="move_to_block"]
[connection signal="s_win" from="Puzzle/PuzzleSkullFinder" to="RoomBlocker" method="move_to_unblock"]
[connection signal="s_lose" from="PuzzleTreasures/PuzzleRun" to="PuzzleTreasures" method="right_puzzle_lost"]
[connection signal="s_opened" from="PuzzleTreasures/TreasureRight" to="PuzzleTreasures/PuzzleRun" method="win_game"]
[connection signal="s_lose" from="PuzzleTreasures/PuzzleAvoidSkulls" to="PuzzleTreasures" method="left_puzzle_lost"]
[connection signal="s_opened" from="PuzzleTreasures/TreasureLeft" to="PuzzleTreasures/PuzzleAvoidSkulls" method="win_game"]
